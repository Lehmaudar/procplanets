<!DOCTYPE html>
<html>
  <head>
    <title>ProcPlanets</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <!-- External libraries from the web -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.5/dat.gui.min.js"></script>
    <script src="http://wzrd.in/standalone/uuid%2Fv1@latest"></script>
    <script src="http://threejs.org/examples/js/controls/TrackballControls.js"></script> -->

    <!-- External libraries from local machine -->
    <script type="text/javascript" src="js/external/three.r96.js"></script>
    <script type="text/javascript" src="js/external/stats.min.js"></script>
    <script type="text/javascript" src="js/external/dat.gui.min.js"></script>
    <script type="text/javascript" src="js/external/uuid_v1@latest.js"></script>
    <script
      type="text/javascript"
      src="js/external/TrackballControls.js"
    ></script>

    <!-- Project js files -->
    <script type="text/javascript" src="js/icosphere.js"></script>

    <style>
      body {
        overflow: hidden;
        padding: 0;
        margin: 0;
        color: #222;
        background-color: #111;
        font-family: arial;
        font-size: 100%;
      }
    </style>
  </head>
  <body>
    <!-- three.js container -->
    <div id="container"></div>
    <!-- info on screen display -->
    <script type="text/javascript">
      var stats, scene, renderer, composer;
      var camera, cameraControls;
      var icosphere;

      // dat.gui ui
      var Variables = function() {
        this.spinSpeed = 0.0;
        this.tessConstant = 0.15;
        this.tessGive = 0.05;
        this.tessZoomIn = false;
        this.tessZoomOut = true;
        this.wireframe = false;
        this.vertexColors = true;
      };
      var variables = new Variables();
      var gui = new dat.GUI();

      var folder1 = gui.addFolder("Appearance");
      var folder2 = gui.addFolder("Tesselation");
      folder1.open();
      folder2.open();
      folder1.add(variables, "spinSpeed", 0, 2);
      folder2.add(variables, "tessConstant", 0.05, 0.6);
      folder2.add(variables, "tessGive", 0, 0.1);
      folder2.add(variables, "tessZoomIn");
      folder2.add(variables, "tessZoomOut");
      var wireframe = folder1.add(variables, "wireframe");
      var vertexColors = folder1.add(variables, "vertexColors");
      wireframe.onChange(function(value) {
        icosphere.material.wireframe = value;
      });
      vertexColors.onChange(function(value) {
        value
          ? (icosphere.material.vertexColors = 1)
          : (icosphere.material.vertexColors = 0);
        icosphere.material.needsUpdate = true;
      });

      if (!init()) animate();

      // init the scene
      function init() {
        renderer = new THREE.WebGLRenderer({
          antialias: true // to get smoother output
        });
        renderer.setClearColor(0x000);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById("container").appendChild(renderer.domElement);

        // add Stats.js - https://github.com/mrdoob/stats.js
        stats = new Stats();
        stats.domElement.style.position = "absolute";
        stats.domElement.style.bottom = "0px";
        document.body.appendChild(stats.domElement);

        // create a scene
        scene = new THREE.Scene();

        // put a camera in the scene
        camera = new THREE.PerspectiveCamera(
          35,
          window.innerWidth / window.innerHeight,
          0.00001,
          10000
        );
        camera.position.set(0, 0, 5);
        scene.add(camera);

        // create a camera contol
        cameraControls = new THREE.TrackballControls(
          camera,
          renderer.domElement
        );

        // Objects
        icosphere();
      }

      // animation loop
      function animate() {
        requestAnimationFrame(animate);

        // do the render
        render();

        // update stats
        stats.update();
      }

      // render the scene
      function render() {
        // variable which is increase by Math.PI every seconds - usefull for animation
        var PIseconds = Date.now() * Math.PI;

        // update camera controls
        cameraControls.update();

        // animation of all objects
        scene.traverse(function(object3d, i) {
          // TODO: spin camera not objects
          if (object3d instanceof THREE.Mesh === false) return;
          object3d.rotation.y =
            variables.spinSpeed * PIseconds * 0.0003 * (i % 2 ? 1 : -1);
          object3d.rotation.x =
            variables.spinSpeed * PIseconds * 0.0002 * (i % 2 ? 1 : -1);
        });

        if (variables.tessZoomIn)
          LOD(camera.position, variables.tessConstant, variables.tessGive);
        if (variables.tessZoomOut)
          LODD(camera.position, variables.tessConstant, variables.tessGive);

        // actually render the scene
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
