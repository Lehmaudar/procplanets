<!DOCTYPE html>
<html>
  <head>
    <title>ProcPlanets</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0,
      maximum-scale=1.0"
    />
    <link rel="stylesheet" type="text/css" href="stylesheet.css" />

    <!-- External libraries from local machine (add http://procplanets.tintdisain.ee before each source) -->
    <script type="text/javascript" src="js/external/simplex-noise.js"></script>
    <script type="text/javascript" src="js/external/three.r96.js"></script>
    <script type="text/javascript" src="js/external/stats.min.js"></script>
    <script type="text/javascript" src="js/external/dat.gui.min.js"></script>
    <script
      type="text/javascript"
      src="js/external/TrackballControls.js"
    ></script>
    <script
      type="text/javascript"
      src="js/external/PointerLockControls.js"
    ></script>
    <script
      type="text/javascript"
      src="js/external/THREEx.KeyboardState.js"
    ></script>
    <script type="text/javascript" src="js/external/Tween.js"></script>

    <!-- Project js files -->
    <script type="text/javascript" src="js/icosphere.js"></script>
    <script type="text/javascript" src="js/controls.js"></script>
  </head>
  <body>
    <div id="generate">press to see changes â†’</div>
    <div id="info">
      <div class="line" id="travel">
        <span class="key">space</span> to travel to ground/sky
      </div>
      <div class="line" id="enterpointer">
        <span class="key">P</span> to enter pointercontrols
      </div>
      <div class="line" id="exitpointer">
        <span class="key">ESC</span> to exit pointercontrols
      </div>
    </div>
    <script type="text/javascript">
      var scene, renderer, composer, camera, icosphere, axes;
      var stats, gui, cameraControls, keyboard;
      var variables = datGui();
      var mouseSpeed = 0;
      var zoomSpeed;
      var clock = new THREE.Clock();
      var keyboard = new THREEx.KeyboardState();
      var simplex = new SimplexNoise(variables.seed);

      var trackballControls, pointerLockControls, pointer;
      var raycaster = new THREE.Raycaster();
      var mouse = new THREE.Vector2();
      var goingToGround = false;
      var onGround = false;

      var skyPos = new THREE.Vector3();
      var skyRot = new THREE.Euler();
      var orgRot = new THREE.Euler();
      var skyAxe;
      var testVec = new THREE.Vector3(0, 0, 0);
      var target = new THREE.Vector3(3, -6, 6); // create on init
      var downTween, upTween;

      var frustum = new THREE.Frustum();
      var cameraVector = new THREE.Vector3();
      var colorsNeedUpdate = false;

      var t1, t0;
      var folder1, folder2, folder3;
      var colorNames = [];
      var noiseNames = [];
      var presets = {};

      var conPointer, camPointerHelper, conOrbit;
      var generateRect = {
        top: 0,
        left: 0
      };

      // createjs.RotationPlugin.install();

      init();
      animate();

      // init the scene
      function init() {
        renderer = new THREE.WebGLRenderer({
          antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // window event listeners
        // window.addEventListener("wheel", onMouseWheel, false);
        window.addEventListener("resize", onWindowResize, false);

        // add keyboard
        keyboard = new THREEx.KeyboardState(renderer.domElement);
        renderer.domElement.setAttribute("tabIndex", "0");
        renderer.domElement.focus();

        // add Stats.js - https://github.com/mrdoob/stats.js
        stats = new Stats();
        stats.domElement.style.position = "absolute";
        stats.domElement.style.bottom = "0px";
        document.body.appendChild(stats.domElement);

        // create a scene
        scene = new THREE.Scene();

        // put a camera in the scene
        orgCamera = new THREE.PerspectiveCamera(
          15,
          window.innerWidth / window.innerHeight,
          0.001,
          10000
        );
        orgCamera.position.set(0, 0, 15);
        // scene.add(orgCamera);
        // camera = orgCamera;

        // Dat.GUI
        addNewColor([0, 0, 0], 0.0);
        addNewColor([0, 0, 0], 0.0);
        addNewColor([0, 0, 0], 0.0);
        addNewNoise(0, 0);
        addNewNoise(0, 0);
        addNewNoise(0, 0);
        generateInfo(false);

        // Objects
        icosphere = initIcosphere();
        group = new THREE.Object3D();
        group.add(icosphere);
        scene.add(group);

        skyAxe = new THREE.AxesHelper(0.3);
        skyAxe.position.set(0, 2, 0);
        // icosphere.add(skyAxe);

        axes = new THREE.AxesHelper(2);
        axes.visible = false;
        icosphere.add(axes);

        tetra = new THREE.Mesh(
          new THREE.TetrahedronGeometry(6),
          new THREE.MeshBasicMaterial({ color: 0x009900, wireframe: true })
        );
        // icosphere.add(tetra);
        tetra.rotation.set(-Math.PI / 3.3, Math.PI / 4, Math.PI / 2);

        skyAxeArray = [];
        tetra.updateMatrixWorld();
        for (let i = 0; i < tetra.geometry.vertices.length; i++) {
          var vector = tetra.geometry.vertices[i].clone();
          vector.applyMatrix4(tetra.matrixWorld);

          tetraAxe = new THREE.AxesHelper(0.3);
          tetraAxe.position.copy(vector);
          skyAxeArray.push(tetraAxe);
          // icosphere.add(tetraAxe);
        }

        // Raycaster
        raycaster = new THREE.Raycaster();

        initControls();
        setPreset(...presets.earth);
      }

      // animation loop
      function animate() {
        requestAnimationFrame(animate);
        delta = clock.getDelta();

        // update camera controls
        if (conOrbit != undefined && conOrbit.enabled) {
          smootherControls(delta);
          // conOrbit.update();
        }
        updateInfo();

        TWEEN.update();

        // focus on canvas in case gui has been pressed
        // renderer.domElement.setAttribute("tabIndex", "0");
        // renderer.domElement.focus();

        render();

        stats.update();
      }

      function render() {
        // variable which is increase by Math.PI every seconds - usefull for animation
        var PIseconds = Date.now() * Math.PI;

        LOD(
          camera.position,
          variables.tessConstant / 100,
          variables.tessGive / 30,
          variables.tessZoomIn,
          variables.tessZoomOut
        );

        if (colorsNeedUpdate) upDateColors();

        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
